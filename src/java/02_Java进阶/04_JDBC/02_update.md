---
title: 插入、更新、删除
category: JDBC
tag:
  - 数据库
  - Java
order: 2
---

数据库操作无非是增删改查，即CRUD，前面我们已经提到了查询操作，下面我们来看看插入、更新、删除操作。

## 插入

首先，我们创建创建一个`PreparedStatement`对象，然后使用`executeUpdate()`方法来执行SQL插入操作：

```java
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;

public class Main {
    public static void main(String[] args) {
        String url = "jdbc:mysql://localhost:3306/myDatabase";
        String user = "username";
        String password = "password";

        try {
            Connection conn = DriverManager.getConnection(url, user, password);
            String sql = "INSERT INTO myTable (column1, column2) VALUES (?, ?)";
            PreparedStatement pstmt = conn.prepareStatement(sql);
            pstmt.setString(1, "value1");
            pstmt.setString(2, "value2");
            int rowsAffected = pstmt.executeUpdate();
            System.out.println(rowsAffected + " row(s) inserted.");
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
```

这里的参数设置和查询操作是一样的，同时我们注意到，`executeUpdate()`方法的返回值是`int`整数，它代表插入的记录数。

## 插入并获取主键

有时候，我们想在插入数据后获取生成的主键，可以使用`PreparedStatement`的另一个版本，即`Connection.prepareStatement(String sql, int autoGeneratedKeys)`：

```java
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.Statement;

public class Main {
    public static void main(String[] args) {
        String url = "jdbc:mysql://localhost:3306/myDatabase";
        String user = "username";
        String password = "password";

        try {
            Connection conn = DriverManager.getConnection(url, user, password);
            String sql = "INSERT INTO myTable (column1, column2) VALUES (?, ?)";
            PreparedStatement pstmt = conn.prepareStatement(sql, Statement.RETURN_GENERATED_KEYS);
            pstmt.setString(1, "value1");
            pstmt.setString(2, "value2");
            int rowsAffected = pstmt.executeUpdate();

            if(rowsAffected > 0) {
                try (ResultSet rs = pstmt.getGeneratedKeys()) {
                    if (rs.next()) {
                        int id = rs.getInt(1);
                        System.out.println("Inserted row ID: " + id);
                    }
                } catch (Exception ex) {
                    ex.printStackTrace();
                }
            }
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
```

也就是说，使用`Statement.RETURN_GENERATED_KEYS`作为`prepareStatement`的第二个参数，就可以返回生成的主键，之后调用`getGeneratedKeys()`方法就可以获取一个包含生成的键的`ResultSet`对象。如果插入成功，我们就可以从`ResultSet`中获取生成的主键。

## 更新

在JDBC中，更新操作和插入操作并没有什么区别（除了SQL不一样）：

```java
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;

public class Main {
    public static void main(String[] args) {
        String url = "jdbc:mysql://localhost:3306/myDatabase";
        String user = "username";
        String password = "password";

        try {
            Connection conn = DriverManager.getConnection(url, user, password);

            String sql = "UPDATE myTable SET column1 = ? WHERE condition";
            PreparedStatement pstmt = conn.prepareStatement(sql);

            pstmt.setString(1, "newValue");

            int rowsAffected = pstmt.executeUpdate();
            System.out.println("Rows affected: " + rowsAffected);

            pstmt.close();
            conn.close();
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
```

`executeUpdate()`方法的返回值是数据库实际更新的行数（如果为0，表示没有任何记录更新）

## 删除

同样的，删除操作也是和插入操作相同，即调用`prepareStatement`对象的`executeUpdate`方法：

```java
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;

public class Main {
    public static void main(String[] args) {
        String url = "jdbc:mysql://localhost:3306/myDatabase";
        String user "username";
        String password = "password";

        try {
            Connection conn = DriverManager.getConnection(url, user, password);

            String sql = "DELETE FROM myTable WHERE condition";
            PreparedStatement pstmt = conn.prepareStatement(sql);

            int rowsAffected = pstmt.executeUpdate();
            System.out.println("Rows affected: " + rowsAffected);

            pstmt.close();
            conn.close();
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
```

