---
title: 正则表达式
category: 数据库
order: 1
tag:
  - 关系型数据库
---

## 什么是正则表达式？

正则表达式是一种强大的文本匹配工具，它可以用来匹配、查找、替换文本中的特定模式。

在SQL中，正则表达式常用于`WHERE`子句中，以便更精确地过滤`SELECT`检索出的数据。

## REGEXP 操作符

在MySQL中，我们使用`REGEXP`操作符来进行正则表达式匹配。这是一个强大的工具，可以用来匹配复杂的模式。

下面是MySQL中常用的正则表达式模式。

### （1）.

`.`是正则表达式中的一个特殊字符，用于匹配任意一个字符（除了换行符`\n`）。

例如：

```sql
SELECT * FROM employees
WHERE name REGEXP '.';
```

上述查询将返回所有名字中包含至少一个字符的员工。

### （2）|

`|`操作符用于匹配指定模式中的任一项，类似于逻辑OR。

例如：

```sql
SELECT * FROM employees
WHERE department REGEXP 'Sales|Marketing';
```

这个查询将返回所有在销售部门或市场部门的员工。

### （3）[...]

字符集合`[...]`用于匹配其中的任意一个字符。

例如：

```sql
SELECT * FROM employees
WHERE name REGEXP '[ABC]';
```

这个查询将返回所有名字中包含字符A、B或C的员工。

> 所谓字符集合，就是可以通过一组`[`和`]`来将指定匹配的字符括起来，用于表示括号内的字符只要匹配任意一个即可，效果也类似于OR语句。比如正则模式`[123]`相当于`1|2|3`，意思是匹配1或2或3。

### （4）[^...]

如果在字符集合的开始位置放置一个字符`^`，则表示匹配除了字符集合中的字符以外的任何字符。

例如：

```sql
SELECT * FROM employees
WHERE name REGEXP '[^ABC]';
```

这个查询将返回所有名字中不包含字符A、B和C的员工。

> 这个也很容易理解，比如正则模式`[123]`表示匹配字符1、2或3，而`[^123]`则表示匹配这些字符之外的任何字符。

### （5）-

`-`操作符用于定义字符范围。

例如正则模式`[0123456789]`用于匹配数字0到9中的任意一个字符，那么可以用`[0-9]`来代替，效果是一样的。

```sql
SELECT * FROM employees
WHERE name REGEXP '[A-Z]';
```

这个查询将返回所有名字中包含大写字母的员工。

### （6）\\\

`\\`用于转义特殊字符，使其被视为普通字符。

例如：

```sql
SELECT * FROM employees
WHERE name REGEXP '\\.';
```

这个查询将返回所有名字中包含`.`字符的员工。

> 备注：
>
> - `\\.`用于查找字符`.`
> - `\\-`用于查找字符`-`
> - `\\|`用于查找字符`|`
> - `\\\`用于查找字符`\`
>
>
> 另外，`\\`也可以用来引用元字符，即具有特殊含义的字符。如下所示：
>
> - `\\n`：换行
> - `\\f`：换页
> - `\\r`：回车
> - `\\t`：制表
> - `\\v`：纵向制表

## character class

MySQL支持预定义的字符类，可以用来匹配特定类型的字符。

例如：

```sql
SELECT * FROM employees
WHERE name REGEXP '[[:digit:]]';
```

这个查询将返回所有名字中包含数字的员工。

以下是这些字符类的汇总表格：

| 字符类       | 描述                                           | 等价的字符集  |
| ------------ | ---------------------------------------------- | ------------- |
| `[:alnum:]`  | 任意字母和数字                                 | `[a-zA-Z0-9]` |
| `[:alpha:]`  | 任意字母                                       | `[a-zA-Z]`    |
| `[:digit:]`  | 任意数字                                       | `[0-9]`       |
| `[:xdigit:]` | 任意十六进制数字                               | `[a-fA-F0-9]` |
| `[:lower:]`  | 任意小写字母                                   | `[a-z]`       |
| `[:upper:]`  | 任意大写字母                                   | `[A-Z]`       |
| `[:blank:]`  | 空格和制表符                                   | `[\\t]`       |
| `[:print:]`  | 任意可打印字符                                 | 无            |
| `[:graph:]`  | 与`[:print:]`相同，但不包括空格                | 无            |
| `[:cntrl:]`  | ASCII 控制字符（ASCII 0到31和127）             | 无            |
| `[:punct:]`  | 既不在`[:alnum:]`也不在`[:cntrl:]`中的任意字符 | 无            |

## 重复元字符

上述所记录的正则模式都是单次匹配，如果存在一个匹配，则该行会被检索到。

但是，如果我们想要对匹配的数目进行更强的控制，就需要使用重复元字符，实现多个实例的匹配。

::: tip 提示

重复元字符用于指定一个模式应该匹配的次数。

:::

例如：

```sql
SELECT * FROM employees
WHERE name REGEXP 'a{2,}';
```

这个查询将返回所有名字中包含至少两个连续的'a'的员工。

下面是重复元字符的记录：

- `{n}`：指定数目`n`的匹配，即匹配确定的`n`次。
- `{n,}`：不少于指定数目`n`的匹配。
- `{n,m}`：匹配数目的范围，即最少匹配`n`次且最多匹配`m`次。
- `?`：`0`个或`1`个匹配（同`{0,1}`）
- `*`：`0`个或多个匹配（同`{0,}`）
- `+`：`1`个或多个匹配（同`{1,}`）

## 定位符

我们可以使用定位符来匹配文本的特定位置。

例如：

```sql
SELECT * FROM employees
WHERE name REGEXP '^A';
```

这个查询将返回所有名字以'A'开头的员工。

下面是一些常见的定位符：

- `^`：匹配文本的开始位置。
- `$`：匹配文本的结束位置。
- `[[:<:]]`：匹配词的结束位置。
- `[[:>:]]`：匹配词的结束位置。

> 注意，特殊字符`^`有两个用途：
>
> - 一方面在字符集合的开始位置放置`^`可以起到否定字符集的作用
> - 另一方面，`^`可以用于匹配串的开始位置。