---
title: 守护线程
category: Java
tag:
  - 多线程
order: 7
icon: uis:process
---


Java中的线程可以分为两种类型：用户线程和守护线程。用户线程通常是程序的主要工作线程，而守护线程则用于在后台执行辅助工作。

## 什么是守护线程？

守护线程是一种特殊的线程，它的生命周期依赖于创建它的用户线程。当所有用户线程都结束时，守护线程也会自动结束。它们通常用于执行如垃圾回收、网络连接等后台任务。

## 如何创建守护线程？

在Java中，我们可以通过调用`Thread`类的`setDaemon(true)`方法将线程设置为守护线程。这需要在启动线程之前完成。

```java
Thread thread = new Thread();
thread.setDaemon(true);
thread.start();
```

## 守护线程的注意事项

1. `setDaemon(true)`必须在`start()`方法之前调用，否则会抛出`IllegalThreadStateException`。
2. 守护线程在所有用户线程结束后会立即终止，它们不会执行`finally`块中的代码。
3. 守护线程应该避免执行可能需要长时间运行的任务，因为它们可能会在完成之前被终止。

## 守护线程的应用

守护线程通常用于执行那些不影响程序主要功能，但又需要在后台运行的任务。例如，Java的垃圾回收器就是一个守护线程。

## 小结

守护线程是为其他线程服务的线程，所有非守护线程都执行完毕后，虚拟机会退出，无需关心守护线程是否已结束。但是，守护线程不能持有需要关闭的资源，否则可能会导致数据丢失。理解和正确使用守护线程，可以帮助我们更好地管理和控制线程的生命周期，优化程序的运行效率。